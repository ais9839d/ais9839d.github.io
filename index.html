<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>麥克諾尼 | 日式寵物沙龍</title>
    <meta name="description" content="日式寵物美容、洗護專門店">
    
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            bg: '#F9F4F0',       /* 韓系米白背景 */
                            primary: '#C7B299',  /* 韓國奶茶色 (主色) */
                            secondary: '#E6CCCA',/* 乾燥玫瑰粉 (點綴) */
                            dark: '#8A7B70',     /* 深奶茶 (邊框/副標) */
                            text: '#594A42',     /* 深焙咖啡 (文字) */
                            light: '#9D816F',    /* 淺棕色 (說明文字) */
                            surface: 'rgba(255, 255, 255, 0.65)' /* 磨砂玻璃背景 */
                        },
                    },
                    fontFamily: {
                        sans: ['Arial', 'Helvetica', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            background-color: #F9F4F0;
            color: #594A42;
            font-family: Arial, Helvetica, sans-serif;
            overflow-x: hidden;
        }

        /* 玻璃擬態卡片 */
        .glass-card {
            background-color: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 1.5rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        /* 選項卡片樣式 */
        .option-card {
            cursor: pointer;
            border: 1px solid rgba(199, 178, 153, 0.2); /* brand-primary/20 */
            background-color: rgba(255, 255, 255, 0.4);
            transition: all 0.2s;
        }
        
        /* 選中狀態 (由 JS 控制 class) */
        .option-card.selected {
            background-color: #ffffff;
            border-color: rgba(199, 178, 153, 0.8);
            box-shadow: 0 4px 20px rgba(184, 166, 155, 0.15);
        }

        /* 輸入框樣式 */
        .input-style {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(199, 178, 153, 0.2);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: #594A42; /* brand-text */
            outline: none;
            transition: all 0.2s;
        }
        .input-style:focus {
            background-color: #ffffff;
            border-color: rgba(199, 178, 153, 0.5);
        }
        .input-style::placeholder {
            color: #94a3b8;
        }

        /* 動畫 */
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }
        .animate-float { animation: float 8s ease-in-out infinite; }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.6s ease-out forwards; }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .animate-scroll { animation: scroll 20s linear infinite; }

        /* 隱藏捲軸但保留功能 */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 頁面切換控制 */
        .view-section {
            display: none; /* 預設隱藏所有區塊 */
        }
        .view-section.active {
            display: block; /* 只有 active 的顯示 */
        }
    </style>
</head>
<body class="min-h-screen pb-28 relative">

    <div class="fixed rounded-full blur-[120px] -z-10 opacity-40 bg-brand-secondary top-[-15%] right-[-25%] w-[500px] h-[500px] animate-float"></div>
    <div class="fixed rounded-full blur-[100px] -z-10 opacity-50 bg-[#CDB5A8] bottom-[5%] left-[-20%] w-[400px] h-[400px] animate-float" style="animation-direction: reverse;"></div>

    <nav class="fixed top-0 w-full z-40 bg-brand-bg/80 backdrop-blur-md px-6 py-3 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-4 cursor-pointer" onclick="switchView('home')">
            <img src="logo.jpg" onerror="this.src='https://placehold.co/100x100?text=Logo'" alt="Logo" class="w-12 h-12 object-cover rounded-full border border-brand-primary/30">
            <div class="flex items-center">
                <span class="text-3xl font-bold tracking-tighter text-brand-text">麥克諾尼</span>
                <span class="text-2xl text-brand-primary/40 mx-2 font-light">|</span>
                <div class="flex flex-col justify-center">
                    <span class="text-[13px] font-bold leading-tight text-brand-dark">日式寵物沙龍</span>
                    <span class="text-[10px] text-brand-light tracking-wider leading-tight font-medium uppercase">ペットサロン</span>
                </div>
            </div>
        </div>
        <button id="back-btn" onclick="switchView('home')" class="text-brand-light hover:text-brand-text transition-colors hidden">
            <i data-lucide="arrow-left" class="w-6 h-6"></i>
        </button>
    </nav>

    <main class="pt-24 px-5 max-w-lg mx-auto space-y-8">
        
        <div id="view-home" class="view-section active animate-fade-in space-y-8">
            <div class="text-center space-y-4">
                <div class="w-28 h-28 mx-auto mb-2 rounded-full p-1 border border-brand-primary/20 overflow-hidden">
                    <img src="logo.jpg" onerror="this.src='https://placehold.co/200x200?text=Logo'" alt="Logo" class="w-full h-full object-cover rounded-full">
                </div>
                <h1 class="text-2xl font-bold font-serif text-brand-primary italic">毛小孩的笑容是最甜蜜的糖果</h1>
<div class="flex flex-wrap justify-center gap-2 px-4">
                    <span class="text-[10px] text-brand-light bg-brand-primary/10 px-2 py-0.5 rounded-full tracking-wider">#台北市松山區</span>
                    <span class="text-[10px] text-brand-light bg-brand-primary/10 px-2 py-0.5 rounded-full tracking-wider">#全新裝修空間</span>
                    <span class="text-[10px] text-brand-light bg-brand-primary/10 px-2 py-0.5 rounded-full tracking-wider">#全程手工吹整</span>
                    <span class="text-[10px] text-brand-light bg-brand-primary/10 px-2 py-0.5 rounded-full tracking-wider">#日式寵物美容</span>
                    <span class="text-[10px] text-brand-light bg-brand-primary/10 px-2 py-0.5 rounded-full tracking-wider">#合格寵物美容師</span>
                    <span class="text-[10px] text-brand-light bg-brand-primary/10 px-2 py-0.5 rounded-full tracking-wider">#客製化皮毛護理</span>
                    <span class="text-[10px] text-brand-light bg-brand-primary/10 px-2 py-0.5 rounded-full tracking-wider">#每日消毒清潔</span>
                    <span class="text-[10px] text-brand-light bg-brand-primary/10 px-2 py-0.5 rounded-full tracking-wider">#高齡犬友善</span>
                </div>
                <p class="text-xs text-brand-light leading-relaxed px-4 text-justify mx-auto max-w-xs">
                    承襲日式寵物文化 30 年。我們秉持「家人」的初衷，提供最高品質的洗護與專業諮詢。
                </p>
            </div>

            <div class="overflow-hidden relative w-full h-32 rounded-2xl cursor-pointer shadow-sm border border-white/60" onclick="switchView('products')">
                <div class="absolute inset-0 z-20 flex flex-col justify-center items-center text-white bg-black/25 backdrop-blur-[1px]">
                    <h3 class="font-bold text-lg tracking-widest drop-shadow-md">嚴選日系洗護</h3>
                    <p class="text-[10px] opacity-90 uppercase">Premium Japanese Spa Showcase</p>
                </div>
                <div class="flex w-[400%] h-full animate-scroll">
                    <div class="flex w-full h-full" id="banner-container">
                        </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="switchView('grooming')" class="glass-card p-6 text-left hover:-translate-y-1 transition-all group">
                    <i data-lucide="scissors" class="w-6 h-6 mb-4 text-brand-primary"></i>
                    <h3 class="font-bold text-brand-text">美容預約</h3>
                    <p class="text-[10px] text-brand-light mt-1">建立電子契約與服務</p>
                </button>
                <button onclick="switchView('products')" class="glass-card p-6 text-left hover:-translate-y-1 transition-all group">
                    <i data-lucide="sparkles" class="w-6 h-6 mb-4 text-brand-primary"></i>
                    <h3 class="font-bold text-brand-text">產品介紹</h3>
                    <p class="text-[10px] text-brand-light mt-1">查看高級洗劑詳情</p>
                </button>
            </div>

            <div class="glass-card p-5 border-l-4 border-brand-primary space-y-3 shadow-sm">
                <h4 className="font-bold text-sm flex items-center gap-2 text-brand-text">
                    <div class="flex items-center gap-2 font-bold text-sm text-brand-text">
                        <i data-lucide="store" class="w-4 h-4 text-brand-primary"></i> 門市資訊
                    </div>
                </h4>
                <ul class="text-xs space-y-2">
                    <li><span class="text-brand-light w-16 inline-block">營業時間</span> 09:00 - 18:00</li>
                    <li><span class="text-brand-light w-16 inline-block">公休日</span> 週三、週日</li>
                    <li><span class="text-brand-light w-16 inline-block">預約電話</span> 02-27129404</li>
                </ul>
            </div>

            <div class="w-full max-w-sm mx-auto pt-4 pb-8">
                <div class="bg-white/80 backdrop-blur-md rounded-full shadow-lg p-1.5 flex justify-between items-center px-6 border border-white/60">
                    <i data-lucide="facebook" class="w-5 h-5 text-brand-light cursor-pointer hover:text-blue-600"></i>
                    <a href="https://line.me/ti/p/@ais9839d" target="_blank" class="bg-[#06C755] text-white px-5 py-2.5 rounded-full flex items-center gap-2 shadow-lg -mt-5 hover:scale-105 transition-transform">
                        <i data-lucide="message-circle" class="w-4 h-4"></i>
                        <span class="text-xs font-bold">預約諮詢</span>
                    </a>
                    <i data-lucide="instagram" class="w-5 h-5 text-brand-light cursor-pointer hover:text-pink-600"></i>
                </div>
            </div>
        </div>

        <div id="view-products" class="view-section animate-fade-in space-y-8 pb-20">
            <div class="text-center space-y-2">
                <h2 class="text-xl font-bold">嚴選日系洗護系列</h2>
                <p class="text-[10px] text-brand-light px-6">堅持全程採用日本進口洗劑，給毛孩如空氣般柔軟的呵護</p>
            </div>

            <div class="glass-card p-5 space-y-4 shadow-md bg-white/80">
                <div class="aspect-[21/9] rounded-xl overflow-hidden bg-[#fafafa] flex items-center justify-center">
                    <img src="line_oa_chat_260116_170322.jpg" onerror="this.src='https://placehold.co/600x300?text=Product'" class="max-w-full max-h-full object-contain" alt="ZOIC Cats">
                </div>
                <div class="text-center">
                    <span class="text-[10px] bg-brand-secondary text-brand-text px-2 py-0.5 rounded-full font-bold mb-2 inline-block tracking-widest uppercase">Hero Product</span>
                    <h3 class="text-lg font-bold text-brand-text">ZOIC 貓咪專用洗護</h3>
                    <p class="text-xs text-brand-light mt-1">針對貓咪膚質開發，極致柔軟與蓬鬆感的完美呈現</p>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4" id="product-list">
                </div>
        </div>

        <div id="view-grooming" class="view-section animate-fade-in space-y-6 pb-20">
            <div class="text-center space-y-2">
                <h2 class="text-xl font-bold">美容預約單</h2>
                <p class="text-xs text-brand-light">請填寫詳細資料以建立電子預約契約</p>
            </div>

            <div class="glass-card p-6 border-none bg-white shadow-sm relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-[#06C755]/10 rounded-full blur-3xl"></div>
                <div class="relative z-10 space-y-5">
                    <div class="text-center space-y-1">
                        <h3 class="text-xl font-black text-brand-text flex items-center justify-center gap-2">
                            <i data-lucide="message-circle" class="w-6 h-6 text-[#06C755] fill-current"></i>
                            加入官方 LINE
                        </h3>
                        <p class="text-xs text-brand-light font-bold">ID: @ais9839d</p>
                    </div>
                    
                    <div className="grid grid-cols-1 gap-3">
                        <a href="https://line.me/ti/p/@ais9839d" target="_blank" class="bg-[#fbf9f6] border border-[#06C755]/30 rounded-2xl p-4 flex flex-col items-center justify-center gap-1 hover:bg-[#06C755]/5 transition-colors group">
                            <div class="w-6 h-6 rounded-full bg-[#06C755] text-white flex items-center justify-center font-black text-xs mb-1">1</div>
                            <span class="font-bold text-base text-[#06C755]">點擊加入好友</span>
                            <div class="mt-1 w-full py-2 bg-[#06C755] text-white rounded-lg text-center font-bold text-xs shadow-md group-hover:scale-105 transition-transform">立即加 LINE</div>
                        </a>
                        <div class="bg-red-50 border border-red-200 rounded-2xl p-4 flex flex-col items-center justify-center gap-1 text-center relative overflow-hidden mt-3">
                            <div class="w-6 h-6 rounded-full bg-red-500 text-white flex items-center justify-center font-black text-xs mb-1 relative z-10">2</div>
                            <span class="font-bold text-base text-red-600 relative z-10">務必「傳送貼圖」</span>
                            <span class="text-[10px] font-bold text-red-500 relative z-10">⚠️ 沒傳貼圖，我們就找不到您囉！</span>
                        </div>
                    </div>

                    <button id="line-check-btn" onclick="toggleLineCheck()" class="w-full flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold transition-all duration-300 border bg-white text-brand-light border-slate-200">
                        <div id="line-check-icon" class="w-4 h-4 rounded-full border border-current flex items-center justify-center"></div>
                        <span id="line-check-text" class="text-sm">確認：我已完成上述兩步驟</span>
                    </button>
                </div>
            </div>

            <form id="booking-form" class="space-y-6" onsubmit="handleFormSubmit(event)">
              
                <section class="glass-card p-6 space-y-4">
                    <h3 class="text-sm font-bold flex items-center gap-2 text-brand-dark border-b border-brand-primary/10 pb-2">
                        <div class="w-1.5 h-1.5 bg-brand-primary rounded-full"></div> 一、飼主基本資料
                    </h3>
                    
<div class="space-y-1">
                        <label class="text-xs font-bold text-brand-light ml-1">手機號碼 *</label>
                        <div class="flex gap-2">
                            <input type="tel" name="phone" id="phone" class="input-style" placeholder="09xxxxxxxx" required>
                            <button type="button" onclick="autoFillDemo()" class="whitespace-nowrap px-4 bg-brand-primary text-white text-xs font-bold rounded-xl shadow-sm active:scale-95 transition-transform">帶入紀錄</button>
                        </div>
                        <p class="text-[12px] text-brand-light/80 pl-1 flex items-center gap-1 pt-1">
                            <i data-lucide="info" class="w-3 h-3"></i>
                            曾填寫的客戶，輸入號碼後點擊按鈕可帶入過往資料
                        </p>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-brand-light ml-1">飼主姓名 *</label>
                            <input type="text" name="ownerName" id="ownerName" class="input-style" placeholder="" required>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-brand-light ml-1">身分證字號 *</label>
                            <input type="text" name="ownerId" id="ownerId" class="input-style" placeholder="" required>
                        </div>
                    </div>

                    <div class="space-y-1">
                        <label class="text-xs font-bold text-brand-light ml-1">電子信箱 (寄送契約副本) *</label>
                        <input type="email" name="email" id="email" class="input-style" placeholder="example@email.com" required>
                    </div>

                    <div class="space-y-1">
                        <label class="text-xs font-bold text-brand-light ml-1">通訊地址 *</label>
                        <input type="text" name="address" id="address" class="input-style" placeholder="" required>
                    </div>

                    <div class="grid grid-cols-2 gap-3 bg-brand-bg/50 p-3 rounded-xl border border-brand-primary/10">
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-brand-dark ml-1">緊急聯絡人 *</label>
                            <input type="text" name="emergencyName" id="emergencyName" class="input-style" placeholder="" required>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-brand-dark ml-1">緊急電話 *</label>
                            <input type="tel" name="emergencyPhone" id="emergencyPhone" class="input-style" placeholder="" required>
                        </div>
                    </div>

                    <div class="space-y-1">
                        <label class="text-xs font-bold text-brand-light ml-1">指定就醫醫院</label>
                        <input type="text" name="preferredClinic" id="preferredClinic" class="input-style" placeholder="若無請填無，將送往特約醫院">
                    </div>
                </section>

<section class="glass-card p-6 space-y-5">
    <h3 class="text-sm font-bold flex items-center gap-2 text-brand-dark border-b border-brand-primary/10 pb-2">
        <div class="w-1.5 h-1.5 bg-brand-secondary rounded-full"></div> 二、寵物詳細資料
    </h3>
    <div class="space-y-1">
        <label class="text-xs font-bold text-brand-light ml-1">寵物種類 *</label>
        <div class="flex gap-2">
            <label class="option-card flex-1 py-3 rounded-xl flex items-center justify-center gap-2 text-sm font-bold" onclick="selectSpecies('犬', this)">
                <input type="radio" name="petSpecies" value="犬" class="hidden" required> 
                <i data-lucide="dog" class="w-4 h-4"></i> 狗狗
            </label>
            <label class="option-card flex-1 py-3 rounded-xl flex items-center justify-center gap-2 text-sm font-bold" onclick="selectSpecies('貓', this)">
                <input type="radio" name="petSpecies" value="貓" class="hidden"> 
                <i data-lucide="cat" class="w-4 h-4"></i> 貓咪
            </label>
        </div>
    </div>    

    <div class="grid grid-cols-2 gap-3">
        <div class="space-y-1">
            <label class="text-xs font-bold text-brand-light ml-1">名字 *</label>
            <input type="text" name="petName" id="petName" class="input-style" required>
        </div>
        <div class="space-y-1">
            <label class="text-xs font-bold text-brand-light ml-1">品種 *</label>
            <input type="text" name="breed" id="breed" class="input-style" placeholder="例: 貴賓" required>
        </div>
    </div>
    
    <div class="grid grid-cols-2 gap-3">
        <div class="space-y-1">
            <label class="text-xs font-bold text-brand-light ml-1">體重 (kg) *</label>
            <input type="number" step="0.1" name="weight" id="weight" class="input-style" required>
        </div>
        <div class="space-y-1">
            <label class="text-xs font-bold text-brand-light ml-1">年齡 (歲) *</label>
            <input type="number" name="ageYear" id="ageYear" class="input-style text-center" required oninput="checkRisk(this.value)">
        </div>
    </div>

    <div class="grid grid-cols-2 gap-3">
        <div class="space-y-1">
            <label class="text-xs font-bold text-brand-light ml-1">性別 *</label>
            <div class="flex gap-2">
                <label class="option-card flex-1 py-2 rounded-xl flex items-center justify-center gap-1 text-xs font-bold" onclick="updateRadioStyle(this)">
                    <input type="radio" name="gender" value="公" class="hidden" required> 公
                </label>
                <label class="option-card flex-1 py-2 rounded-xl flex items-center justify-center gap-1 text-xs font-bold" onclick="updateRadioStyle(this)">
                    <input type="radio" name="gender" value="母" class="hidden"> 母
                </label>
            </div>
        </div>
        <div class="space-y-1">
            <label class="text-xs font-bold text-brand-light ml-1">結紮 *</label>
            <div class="flex gap-2">
                <label class="option-card flex-1 py-2 rounded-xl flex items-center justify-center gap-1 text-xs font-bold" onclick="updateRadioStyle(this)">
                    <input type="radio" name="ligation" value="是" class="hidden" required> 是
                </label>
                <label class="option-card flex-1 py-2 rounded-xl flex items-center justify-center gap-1 text-xs font-bold" onclick="updateRadioStyle(this)">
                    <input type="radio" name="ligation" value="否" class="hidden"> 否
                </label>
            </div>
        </div>
    </div>

    <div class="space-y-2 pt-2 border-t border-brand-primary/10">
        <label class="text-xs font-bold text-brand-light ml-1">過往病史 *</label>
        <div class="flex gap-2 mb-2">
            <label class="option-card flex-1 py-2 rounded-xl flex items-center justify-center gap-1 text-xs font-bold" onclick="updateRadioStyle(this); toggleInput('medical-input', true)">
                <input type="radio" name="medicalHistory" value="有" class="hidden"> 有
            </label>
            <label class="option-card flex-1 py-2 rounded-xl flex items-center justify-center gap-1 text-xs font-bold" onclick="updateRadioStyle(this); toggleInput('medical-input', false)">
                <input type="radio" name="medicalHistory" value="無" class="hidden" checked> 無
            </label>

        </div>
        <input type="text" id="medical-input" name="medicalDetail" class="input-style hidden" placeholder="請說明過往病史...">
    </div>

    <div class="space-y-2">
        <label class="text-xs font-bold text-brand-light ml-1">社交狀況 *</label>
        <div class="grid grid-cols-2 gap-2">
            <label class="option-card p-3 rounded-xl flex items-center justify-center text-center text-[11px] font-bold leading-tight" onclick="updateRadioStyle(this)">
                <input type="radio" name="socialStatus" value="有攻擊性" class="hidden" required> 有攻擊性
            </label>
            <label class="option-card p-3 rounded-xl flex items-center justify-center text-center text-[11px] font-bold leading-tight" onclick="updateRadioStyle(this)">
                <input type="radio" name="socialStatus" value="無攻擊性" class="hidden"> 無攻擊性
            </label>
            <label class="option-card p-3 rounded-xl flex items-center justify-center text-center text-[11px] font-bold leading-tight" onclick="updateRadioStyle(this)">
                <input type="radio" name="socialStatus" value="可與狗玩" class="hidden"> 可與狗朋友們<br>一起玩耍
            </label>
            <label class="option-card p-3 rounded-xl flex items-center justify-center text-center text-[11px] font-bold leading-tight" onclick="updateRadioStyle(this)">
                <input type="radio" name="socialStatus" value="不可與狗玩" class="hidden"> 不能與狗朋友們<br>一起玩耍
            </label>
        </div>
    </div>

    <div class="space-y-2">
        <label class="text-xs font-bold text-brand-light ml-1">寵物美容性情與攻擊性評估 *</label>
        <div class="space-y-2">
            <label class="option-card p-3 rounded-xl flex items-start gap-3 cursor-pointer group" onclick="updateRadioStyle(this)">
                <input type="radio" name="temperament" value="天使寶寶" class="hidden" required>
                <div class="w-2 h-2 rounded-full bg-brand-primary mt-1.5 shrink-0 group-[.selected]:bg-brand-dark"></div>
                <div>
                    <span class="text-xs font-bold text-brand-text block">天使寶寶</span>
                    <span class="text-[10px] text-brand-light">個性溫和，無任何攻擊紀錄，也不怕生。</span>
                </div>
            </label>
            
            <label class="option-card p-3 rounded-xl flex items-start gap-3 cursor-pointer group" onclick="updateRadioStyle(this)">
                <input type="radio" name="temperament" value="有點緊張" class="hidden">
                <div class="w-2 h-2 rounded-full bg-brand-primary mt-1.5 shrink-0 group-[.selected]:bg-brand-dark"></div>
                <div>
                    <span class="text-xs font-bold text-brand-text block">有點緊張</span>
                    <span class="text-[10px] text-brand-light">膽小怕生，可能會低吼或閃躲，但未曾咬人。</span>
                </div>
            </label>

            <label class="option-card p-3 rounded-xl flex items-start gap-3 cursor-pointer group border-l-4 border-l-transparent hover:border-l-red-400" onclick="updateRadioStyle(this)">
                <input type="radio" name="temperament" value="恰北北/護主" class="hidden">
                <div class="w-2 h-2 rounded-full bg-red-400 mt-1.5 shrink-0"></div>
                <div>
                    <span class="text-xs font-bold text-red-700 block">恰北北 / 護主</span>
                    <span class="text-[10px] text-brand-light">對於特定部位敏感，或看到陌生人/狗貓會兇，曾有攻擊或試圖咬人紀錄。</span>
                    <span class="text-[10px] font-bold text-red-500 block mt-1 bg-red-50 px-2 py-1 rounded">⚠️ 請務必告知讓我們做好防護準備</span>
                </div>
            </label>
        </div>
    </div>

    <div class="space-y-2 pt-2 border-t border-brand-primary/10">
        <label class="text-xs font-bold text-brand-light ml-1">晶片號碼 *</label>
        <div class="grid grid-cols-3 gap-2 mb-2">
             <label class="option-card py-2 rounded-xl flex items-center justify-center text-[10px] font-bold" onclick="updateRadioStyle(this); toggleInput('chip-input', true)">
                <input type="radio" name="chipStatus" value="有晶片" class="hidden" required> 有晶片
            </label>
            <label class="option-card py-2 rounded-xl flex items-center justify-center text-[10px] font-bold" onclick="updateRadioStyle(this); toggleInput('chip-input', false)">
                <input type="radio" name="chipStatus" value="有晶片(號碼不詳)" class="hidden"> 有晶片<br>(號碼不詳)
            </label>
            <label class="option-card py-2 rounded-xl flex items-center justify-center text-[10px] font-bold" onclick="updateRadioStyle(this); toggleInput('chip-input', false)">
                <input type="radio" name="chipStatus" value="無晶片" class="hidden"> 無晶片
            </label>
        </div>
        <input type="text" id="chip-input" name="chipId" class="input-style hidden" placeholder="請輸入完整晶片號碼">
    </div>
</section>

                <section class="glass-card p-6 border border-brand-primary/20 bg-white/60">
                    <h3 class="text-sm font-bold flex items-center gap-2 text-brand-dark mb-4">
                        <div class="w-1.5 h-1.5 bg-brand-primary rounded-full"></div> 服務項目與計價
                    </h3>
                    
<div class="grid grid-cols-2 gap-3 mb-3">
                        <label class="option-card relative p-4 rounded-2xl flex flex-col items-center justify-center gap-2 text-center h-32 group" onclick="toggleOtherInput(false)">
                            <input type="radio" name="serviceType" value="精緻洗澡洗+護" class="absolute opacity-0 w-full h-full cursor-pointer" checked>
                            <i data-lucide="droplets" class="w-8 h-8 text-brand-primary group-hover:scale-110 transition-transform"></i>
                            <div>
                                <h4 class="text-sm font-bold text-brand-text">精緻洗護</h4>
                                <p class="text-[10px] text-brand-light mt-1 leading-tight">二次洗護、剪指甲、清耳朵、剃雜毛、肛門腺、臉部整理</p>
                            </div>
                        </label>

                        <label class="option-card relative p-4 rounded-2xl flex flex-col items-center justify-center gap-2 text-center h-32 group" onclick="toggleOtherInput(false)">
                            <input type="radio" name="serviceType" value="精緻造型剪毛" class="absolute opacity-0 w-full h-full cursor-pointer">
                            <i data-lucide="scissors" class="w-8 h-8 text-brand-primary group-hover:scale-110 transition-transform"></i>
                            <div>
                                <h4 class="text-sm font-bold text-brand-text">精緻修剪</h4>
                                <p class="text-[10px] text-brand-light mt-1 leading-tight">精緻洗護 + 造型修剪</p>
                            </div>
                        </label>
                    </div>

                    <div class="mb-6 space-y-3">
                        <label class="option-card relative p-3 rounded-xl flex items-center justify-center gap-2 text-center group" onclick="toggleOtherInput(true)">
                            <input type="radio" name="serviceType" value="其他項目" class="absolute opacity-0 w-full h-full cursor-pointer">
                            <span class="text-sm font-bold text-brand-text">其他項目</span>
                            <i data-lucide="more-horizontal" class="w-4 h-4 text-brand-primary"></i>
                        </label>

                        <div id="other-input-container" class="hidden animate-fade-in">
                            <input type="text" name="otherServiceDetail" id="otherServiceDetail" class="input-style bg-white border-brand-primary/50" placeholder="請輸入您需要的服務項目...">
                        </div>
                    </div>
<div class="space-y-4 mb-6">
                        <h4 class="text-xs font-bold text-brand-text flex items-center gap-1">
                            <i data-lucide="sparkles" class="w-3 h-3 text-brand-primary"></i> 升級 SPA
                        </h4>

                        <div id="dog-spa-list" class="hidden animate-fade-in">
                            <div class="bg-white/40 backdrop-blur-sm border border-brand-primary/30 rounded-2xl overflow-hidden shadow-sm">
                                <div class="bg-brand-primary/5 p-4 border-b border-brand-primary/10 space-y-3">
                                    <div class="flex items-center gap-2">
                                        <span class="bg-brand-primary text-white text-[10px] px-2 py-0.5 rounded-full font-bold shadow-sm">狗狗專屬</span>
                                        <span class="text-xs font-bold text-brand-text">奢華護理方案</span>
                                    </div>
                                    
                                    <div class="space-y-2 pl-1">
                                        <div class="flex items-start gap-2">
                                            <span class="text-[11px] font-black text-brand-primary shrink-0 mt-0.5 border border-brand-primary/30 px-1.5 rounded bg-white">基礎</span>
                                            <p class="text-[11px] text-brand-dark leading-relaxed">
                                                使用 <span class="font-bold text-brand-text">日本 ZOIC 柔順洗護</span>。
                                            </p>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-[11px] font-black text-white shrink-0 mt-0.5 border border-brand-primary bg-brand-primary px-1.5 rounded">升級</span>
                                            <p class="text-[11px] text-brand-dark leading-relaxed">
                                                想給寶貝更進階的服務？<br>可於下方加購 <span class="font-bold text-brand-text">奢華 SPA 服務</span>。
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3 grid grid-cols-1 gap-2 bg-white/20" id="dog-spa-container"></div>
                            </div>
                        </div>

                        <div id="cat-spa-list" class="hidden animate-fade-in">
                            <div class="bg-white/40 backdrop-blur-sm border border-brand-primary/30 rounded-2xl overflow-hidden shadow-sm">
                                <div class="bg-[#E6CCCA]/20 p-4 border-b border-[#E6CCCA]/30 space-y-3">
                                    <div class="flex items-center gap-2">
                                        <span class="bg-brand-secondary text-brand-text text-[10px] px-2 py-0.5 rounded-full font-bold shadow-sm">貓咪專屬</span>
                                        <span class="text-xs font-bold text-brand-text">奢華護理方案</span>
                                    </div>

                                    <div class="space-y-2 pl-1">
                                        <div class="flex items-start gap-2">
                                            <span class="text-[11px] font-black text-brand-secondary shrink-0 mt-0.5 border border-brand-secondary px-1.5 rounded bg-white">基礎</span>
                                            <p class="text-[11px] text-brand-dark leading-relaxed text-justify">
                                                使用 <span class="font-bold text-brand-text">日本 ZOIC 貓咪沙龍 SPA</span><br>
                                                <span class="text-[10px] text-brand-light block mt-0.5">(含木天蓼萃取，能讓貓咪愉悅放鬆)。</span>
                                            </p>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-[11px] font-black text-brand-text shrink-0 mt-0.5 border border-brand-secondary bg-brand-secondary px-1.5 rounded">升級</span>
                                            <p class="text-[11px] text-brand-dark leading-relaxed text-justify">
                                                想給寶貝 <span class="font-bold text-brand-text">義大利進階沙龍洗護</span><br>
                                                可於下方加購 <span class="font-bold text-brand-text">奢華 SPA 服務</span>。
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3 grid grid-cols-1 gap-2 bg-white/20" id="cat-spa-container"></div>
                            </div>
                        </div>

<div class="bg-white/60 border border-brand-primary/30 rounded-xl p-5 space-y-4 shadow-sm mt-4">
                        
                        <div class="flex justify-between items-center text-xs text-brand-light">
                            <span class="font-bold flex items-center gap-1"><i data-lucide="sparkles" class="w-3 h-3"></i> [升級項目] 小計</span>
                            <span id="upgradeTotalDisplay" class="font-mono font-bold text-brand-text">$0</span>
                        </div>

                        <div class="space-y-1">
                            <label class="text-xs font-bold text-brand-dark ml-1">基礎報價 (由店員告知後填寫) *</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2.5 text-brand-light text-xs font-bold">$</span>
                                <input type="number" id="basePrice" class="input-style pl-7 py-2 font-bold text-brand-text" placeholder="請輸入基礎金額" oninput="calculateTotal()">
                            </div>
                            <p class="text-[10px] text-red-500 font-bold bg-red-50 border border-red-100 px-2 py-1.5 rounded-lg flex items-start gap-1">
                                <i data-lucide="alert-circle" class="w-3 h-3 shrink-0 mt-0.5"></i>
                                此金額為基礎報價，若現場發現嚴重打結、寄生蟲等狀況，將另行告知加價。
                            </p>
                        </div>

                        <div class="h-px bg-brand-primary/20 w-full border-t border-dashed border-brand-primary/30"></div>

                        <div class="flex justify-between items-end">
                            <span class="text-sm font-bold text-brand-dark">預估總金額</span>
                            <span id="totalPriceDisplay" class="text-2xl font-black text-brand-text">$0</span>
                        </div>
                    </div>                    
<div class="space-y-4 pt-4 border-t border-brand-primary/10">
                        <h4 class="text-xs font-bold text-brand-text flex items-center gap-1">
                            <i data-lucide="alert-circle" class="w-3 h-3 text-brand-primary"></i> 特殊服務
                        </h4>

                        <label class="option-card p-4 rounded-xl flex items-center gap-3 cursor-pointer group transition-all" onclick="toggleMatting(this)">
                            <input type="checkbox" name="mattingSuspected" class="accent-brand-primary w-4 h-4">
                            <div class="flex-1">
                                <span class="text-sm font-bold text-brand-text flex items-center gap-2">
                                    疑似有打結 
                                    <span class="text-[10px] font-normal text-brand-light bg-brand-primary/10 px-2 rounded-full">需現場評估</span>
                                </span>
                                <span class="text-[11px] text-brand-primary font-bold mt-0.5 block">現場評估拆結費用 300元～2000元</span>
                            </div>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-brand-light transition-transform duration-300" id="matting-arrow"></i>
                        </label>

<div id="matting-details" class="hidden transition-all duration-300 ease-in-out">
                            <div class="bg-white/60 rounded-xl border border-brand-primary/20 p-4 space-y-3 relative">
                                
                                <div class="space-y-4">
                                    <div class="space-y-2">
                                        <h5 class="text-xs font-bold text-brand-dark border-l-4 border-brand-primary pl-2">毛髮打結處理方式（請擇一勾選）</h5>
                                        <p class="text-[11px] text-brand-light leading-relaxed text-justify">
                                            如毛孩於美容過程中發現有毛髮打結、糾結或毛球情形，飼主同意由本店依下列方式處理，並自行勾選確認：
                                        </p>
                                    </div>

                                    <div class="space-y-3">
                                        <label class="block p-3 rounded-lg border border-brand-primary/10 bg-white/80 cursor-pointer hover:border-brand-primary/50 transition-colors">
                                            <div class="flex items-start gap-3">
                                                <input type="radio" name="mattingChoice" value="拆結處理" class="mt-1 accent-brand-primary shrink-0 w-4 h-4">
                                                <div class="space-y-1">
                                                    <span class="text-xs font-bold text-brand-text block">方案一 | 拆結處理 (需另計費)</span>
                                                    <p class="text-[10px] text-brand-light leading-relaxed text-justify opacity-80">
                                                        本人同意由美容師進行拆結處理，並願意支付拆結費用。本人了解拆結過程中可能產生毛髮斷裂、毛量減少或外觀不均屬正常情況，並同意不因此提出異議。<br>
                                                        <span class="text-red-500 font-bold">拆結費用為 NT$300～NT$2000不等</span>，將依毛髮打結之嚴重程度、範圍及實際施作時間評估。<br>
                                                        本店將於美容開始前說明並當場報價，經飼主同意後才會進行，本人了解並同意本店不會於美容過程中臨時加價或就地起價。
                                                    </p>
                                                </div>
                                            </div>
                                        </label>

                                        <label class="block p-3 rounded-lg border border-brand-primary/10 bg-white/80 cursor-pointer hover:border-brand-primary/50 transition-colors">
                                            <div class="flex items-start gap-3">
                                                <input type="radio" name="mattingChoice" value="直接修剪" class="mt-1 accent-brand-primary shrink-0 w-4 h-4">
                                                <div class="space-y-1">
                                                    <span class="text-xs font-bold text-brand-text block">方案二 | 不拆結，直接修剪</span>
                                                    <p class="text-[10px] text-brand-light leading-relaxed text-justify opacity-80">
                                                        本人不願意支付拆結費用，同意美容師於遇到打結時，直接修剪糾結毛髮。<br>
                                                        本人了解修剪後外觀可能出現長短不一、局部稀疏或不平整之情形，並表示可接受，不因此提出異議。
                                    </p>
                                                </div>
                                            </div>
                                        </label>
                                    </div>

                                    <div class="bg-brand-bg/80 p-3 rounded-lg space-y-2 border border-brand-primary/10">
                                        <div class="space-y-1">
                                            <span class="text-[10px] font-bold text-brand-dark block">補充說明一：</span>
                                            <p class="text-[10px] text-brand-light leading-relaxed text-justify">
                                                飼主了解並同意，實際處理方式仍將由美容師依毛孩當下毛況、皮膚狀態及安全考量，進行專業判斷並採取最適合之處理方式。
                                            </p>
                                        </div>
                                        <div class="space-y-1">
                                            <span class="text-[10px] font-bold text-brand-dark block">補充說明二：</span>
                                            <p class="text-[10px] text-brand-light leading-relaxed text-justify">
                                                如美容師評估毛髮打結情況已嚴重影響毛孩皮膚健康，或在處理過程中可能造成明顯疼痛、高度壓力、受傷風險，基於動物福利與安全考量，本店保有拒絕繼續美容或中止服務之權利。<br>
                                                飼主了解並同意，上述情況不視為本店違約，並願意配合後續適當處理建議（如直接剃光）。
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4 pt-4 border-t border-brand-primary/10">
                        <h4 class="text-xs font-bold text-brand-text flex items-center gap-1">
                            <i data-lucide="clock" class="w-3 h-3 text-brand-primary"></i> 逾時與安置費用說明
                        </h4>
                        
                        <div class="bg-[#FFF9F2] border border-[#E6CCCA]/50 rounded-xl p-4 relative overflow-hidden">
                            <ul class="space-y-3">
                                <li class="flex items-center gap-2">
                                    <span class="bg-[#8A7B70] text-white text-[10px] px-2 py-0.5 rounded font-bold shrink-0">1小時內</span>
                                    <span class="text-xs text-brand-text font-bold">免收費。</span>
                                </li>
                                <li class="flex items-center gap-2">
                                    <span class="bg-[#C7B299] text-white text-[10px] px-2 py-0.5 rounded font-bold shrink-0">超過1小時</span>
                                    <span class="text-xs text-brand-text font-bold">以 1 小時計算 ($200/hr)。</span>
                                </li>
                                <li class="pt-2 mt-1">
                                    <div class="bg-red-50 border border-red-200 rounded-lg p-3 shadow-sm">
                                        <div class="flex items-start gap-2">
                                            <i data-lucide="alert-triangle" class="w-4 h-4 text-red-500 shrink-0 mt-0.5"></i>
                                            <p class="text-[11px] text-red-800 leading-relaxed text-justify font-bold">
                                                超過 1 小時以上，本店將先行 <span class="bg-red-200 text-red-900 px-1 rounded">安置犬貓</span> (提供水、飼料、貓砂)，屆時將收取必要之安置費用。
                                            </p>
                                        </div>
</div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="space-y-4 pt-4 border-t border-brand-primary/10">
                        <h4 class="text-xs font-bold text-brand-text flex items-center gap-1">
                            <i data-lucide="wallet" class="w-3 h-3 text-brand-primary"></i> 支付方式 *
                        </h4>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="option-card p-3 rounded-xl flex items-center justify-center gap-2 cursor-pointer group" onclick="updateRadioStyle(this)">
                                <input type="radio" name="paymentMethod" value="現金" class="hidden" required>
                                <div class="w-6 h-6 rounded-full bg-brand-bg flex items-center justify-center text-brand-light group-[.selected]:bg-brand-primary group-[.selected]:text-white transition-colors">
                                    <i data-lucide="banknote" class="w-3.5 h-3.5"></i>
                                </div>
                                <span class="text-sm font-bold text-brand-text">現金支付</span>
                            </label>

                            <label class="option-card p-3 rounded-xl flex items-center justify-center gap-2 cursor-pointer group" onclick="updateRadioStyle(this)">
                                <input type="radio" name="paymentMethod" value="LINE Pay" class="hidden">
                                <img src="linepay.png" alt="LINE Pay" class="h-5 w-auto object-contain">
                            </label>
                        </div>
                    </div>
                </section>

                <section class="glass-card p-6 space-y-4">
                    <h3 class="text-sm font-bold text-brand-dark mb-2">契約條款與簽署</h3>
                    
                    <div id="risk-warning" class="hidden animate-fade-in border-2 border-red-200 bg-red-50 p-4 rounded-xl space-y-2">
                        <div class="flex items-center gap-2 text-red-600 font-bold text-xs">
                          <span class="bg-red-600 text-white px-2 py-0.5 rounded text-[10px]">重要</span>
                          高風險寵物美容服務風險告知
                        </div>
                        <p class="text-[11px] text-red-800 leading-relaxed text-justify">
                          系統檢測您的寵物為 <strong>高齡(8歲+)</strong> 或 <strong>幼體(1歲-)</strong>。
                          <br/>請確認您已知悉相關風險，並同意店家在緊急時刻進行醫療處置。
                        </p>
                        <label class="flex items-center gap-2 mt-2 cursor-pointer">
                          <input type="checkbox" id="risk-checkbox" class="accent-red-500 w-4 h-4" />
                          <span class="text-xs font-bold text-red-700">我已了解並同意承擔高風險服務責任</span>
                        </label>
                    </div>

<label class="flex items-start gap-3 p-2 cursor-pointer mt-2 bg-white/50 rounded-xl">
                        <input type="checkbox" id="agreement" class="mt-1 w-4 h-4 accent-brand-primary" required>
                        <span class="text-xs font-bold text-brand-text pt-0.5">本人已詳閱並同意以上契約內容</span>
                    </label>

                    <div class="space-y-2 pt-4 border-t border-brand-primary/10">
                        <label class="text-xs font-bold text-brand-dark flex items-center gap-1">
                            <i data-lucide="pen-tool" class="w-3 h-3"></i> 數位簽名 *
                        </label>

                        <div id="signature-trigger" onclick="openSignaturePad()" class="w-full h-32 rounded-xl border-2 border-dashed border-brand-primary/30 bg-white/40 flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-white/60 hover:border-brand-primary transition-all group">
                            <div class="w-10 h-10 rounded-full bg-brand-primary/10 flex items-center justify-center text-brand-primary group-hover:scale-110 transition-transform">
                                <i data-lucide="pen-tool" class="w-5 h-5"></i>
                            </div>
                            <span class="text-xs font-bold text-brand-light group-hover:text-brand-text">點擊此處開始簽名</span>
                            <span class="text-[10px] text-brand-primary/60">系統將開啟全螢幕簽名板</span>
                        </div>
                        
                        <div id="signature-result" class="hidden relative group animate-fade-in">
                            <div class="w-full bg-white border border-brand-primary/20 rounded-xl p-4 relative overflow-hidden shadow-sm">
                                <button type="button" onclick="resetSignature()" class="absolute top-2 right-2 p-2 bg-gray-50 text-gray-400 hover:bg-red-50 hover:text-red-500 rounded-lg transition-colors z-20">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                                
                                <div class="flex justify-center my-1 relative z-10 h-20">
                                    <img id="sig-image" src="" alt="您的簽名" class="h-full object-contain">
                                </div>
                                
                                <div class="h-px bg-brand-primary/10 w-full my-2"></div>
                                
                                <div class="flex items-center justify-between gap-2">
                                    <div class="bg-[#06C755]/10 text-[#06C755] px-2 py-1 rounded-md text-[10px] font-black flex items-center gap-1 border border-[#06C755]/20">
                                        <i data-lucide="check-circle" class="w-3 h-3"></i> 已簽署
                                    </div>
                                    <div class="flex items-center gap-1 text-[10px] text-gray-400 font-mono bg-gray-50 px-2 py-1 rounded">
                                        <i data-lucide="clock" class="w-3 h-3"></i>
                                        <span id="sig-timestamp">--:--:--</span>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" name="signatureData" id="signatureData" required>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-brand-text text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-all hover:bg-brand-dark mt-4">
                        <i data-lucide="check-circle" class="w-4 h-4"></i> 確認送出預約
                    </button>
                </section>

            </form>
        </div>

    </main>

    <script>
        // 1. 初始化圖示
        lucide.createIcons();

        // 2. 資料設定 (注意：移除最前面的 /)
        const bannerImages = [
            'line_oa_chat_260116_170310_group_0.jpg',
            'line_oa_chat_260116_170310_group_1.jpg',
            'line_oa_chat_260116_170310_group_2.jpg',
            'line_oa_chat_260116_170310_group_3.jpg',
            'line_oa_chat_260116_170310_group_4.jpg',
            'line_oa_chat_260116_170310_group_5.jpg',
            'line_oa_chat_260116_170310_group_6.jpg',
            'line_oa_chat_260116_170310_group_7.jpg',
            'line_oa_chat_260116_170322.jpg',
        ];

        const productList = [
            { title: "紅寶系列", sub: "進階美容專用", img: "line_oa_chat_260116_170310_group_0.jpg" },
            { title: "魚子醬系列", sub: "頂級精華修復", img: "line_oa_chat_260116_170310_group_1.jpg" },
            { title: "艾詩貝客製化皮膚調理", sub: "礦物元素SPA", img: "line_oa_chat_260116_170310_group_2.jpg" },
            { title: "RENADOG", sub: "韓國專業造型剪毛洗護SPA", img: "line_oa_chat_260116_170310_group_3.jpg" },
            { title: "SKIMO 頂級奈米護膚", sub: "日系新感覺保濕", img: "line_oa_chat_260116_170310_group_4.jpg" },
            { title: "Furmake EX", sub: "專業蓬鬆洗劑", img: "line_oa_chat_260116_170310_group_5.jpg" },
            { title: "ZOIC Cut-X", sub: "日本職人專用造型噴霧", img: "line_oa_chat_260116_170310_group_6.jpg" },
            { title: "ZOIC炭酸泉", sub: "深層清潔美肌", img: "line_oa_chat_260116_170310_group_7.jpg" }
        ];

        const dogSpas = [
            { name: '日本 ZOIC 碳酸 SPA', price: '+199' },
            { name: '日本頂級 SKIMO 奈米 SPA', price: '+399' },
            { name: '義大利魚子醬 SPA', price: '+399' },
            { name: '義大利柑橘廢毛SPA', price: '+399' },
            { name: '義大利活化抗老百香果SPA', price: '+399' },
            { name: '義大利客製化皮膚調理 SPA', price: '+399~599' },
            { name: '美國去油護理服務/除廢毛 SPA', price: '+300~500' },
        ];

        const catSpas = [
            { name: '義大利客製化皮膚調理 SPA', price: '+399' },
            { name: '義大利魚子醬 SPA', price: '+399' },
            { name: '義大利柑橘/百香果代謝廢毛 SPA', price: '+399' },
            { name: '日本 ZOIC 碳酸 SPA', price: '+199' },
            { name: '日本頂級 SKIMO 奈米 SPA', price: '+399' },
            { name: '美國去油護理服務/除廢毛 SPA', price: '+300~500' },
        ];

        // 3. 初始化渲染函式
        function init() {
            // 渲染 Banner
            const bannerContainer = document.getElementById('banner-container');
            // 重複兩次以利無限捲動
            const allImages = [...bannerImages, ...bannerImages, ...bannerImages, ...bannerImages];
            bannerContainer.innerHTML = allImages.map(src => 
                `<img src="${src}" onerror="this.style.display='none'" class="h-full w-[10%] object-cover" alt="banner">`
            ).join('');

            // 渲染產品
            const productContainer = document.getElementById('product-list');
            productContainer.innerHTML = productList.map(item => `
                <div class="bg-white p-3 rounded-2xl shadow-sm space-y-3">
                  <div class="aspect-square rounded-xl overflow-hidden bg-[#fafafa] flex items-center justify-center">
                    <img src="${item.img}" onerror="this.src='https://placehold.co/150x150?text=Product'" class="max-w-full max-h-full object-contain p-1" alt="${item.title}" />
                  </div>
                  <div class="px-1 text-center">
                    <h4 class="text-xs font-bold text-brand-text leading-tight">${item.title}</h4>
                    <p class="text-[10px] text-brand-light leading-tight">${item.sub}</p>
                  </div>
                </div>
            `).join('');

            // 渲染 SPA
            renderSpaList('dog-spa-container', dogSpas);
            renderSpaList('cat-spa-container', catSpas);

            // 檢查 Hash 路由
            const hash = window.location.hash.replace('#', '');
            if(hash) switchView(hash);
        }

function renderSpaList(id, list) {
            document.getElementById(id).innerHTML = list.map(spa => `
                <label class="flex items-center justify-between p-3 rounded-xl border border-transparent hover:bg-white/80 bg-white/40 transition-all cursor-pointer">
                    <div class="flex items-center gap-3">
                        <input type="checkbox" name="spaUpgrades" value="${spa.name}" data-price="${spa.price}" onchange="calculateTotal()" class="accent-brand-primary">
                        <span class="text-xs font-bold text-brand-text">${spa.name}</span>
                    </div>
                    <span class="text-xs font-bold text-brand-primary">${spa.price}元</span>
                </label>
            `).join('');
        }

        // 新增：控制其他項目輸入框顯示
        function toggleOtherInput(show) {
            const container = document.getElementById('other-input-container');
            const input = document.getElementById('otherServiceDetail');
            
            // 更新卡片選中樣式
            document.querySelectorAll('input[name="serviceType"]').forEach(radio => {
                const card = radio.closest('.option-card');
                if(radio.checked) {
                    card.classList.add('selected', 'bg-white', 'border-brand-primary', 'shadow-md');
                } else {
                    card.classList.remove('selected', 'bg-white', 'border-brand-primary', 'shadow-md');
                }
            });

            if (show) {
                container.classList.remove('hidden');
                input.required = true;
                setTimeout(() => input.focus(), 100);
            } else {
                container.classList.add('hidden');
                input.required = false;
                input.value = ''; // 切換掉時清空輸入
            }
        }

        // 4. 視圖切換邏輯
        function switchView(viewName) {
            // 隱藏所有 section
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            // 顯示目標 section
            const target = document.getElementById('view-' + viewName);
            if(target) target.classList.add('active');
            
            // 捲動到頂部
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // 控制導航按鈕
            const backBtn = document.getElementById('back-btn');
            if (viewName === 'home') {
                backBtn.classList.add('hidden');
                history.pushState(null, null, ' '); // 清除 hash
            } else {
                backBtn.classList.remove('hidden');
                window.location.hash = viewName;
            }
        }

        // 5. Line 確認按鈕邏輯
        let lineConfirmed = false;
        function toggleLineCheck() {
            lineConfirmed = !lineConfirmed;
            const btn = document.getElementById('line-check-btn');
            const icon = document.getElementById('line-check-icon');
            const text = document.getElementById('line-check-text');

            if (lineConfirmed) {
                btn.className = "w-full flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold transition-all duration-300 border bg-[#06C755] text-white border-[#06C755] shadow-lg";
                icon.className = "w-4 h-4 rounded-full border border-white bg-white/20 flex items-center justify-center";
                icon.innerHTML = '<i data-lucide="check" size="10" class="w-3 h-3"></i>';
                text.innerText = "OK！我已加入並傳送貼圖";
                lucide.createIcons();
            } else {
                btn.className = "w-full flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold transition-all duration-300 border bg-white text-brand-light border-slate-200";
                icon.className = "w-4 h-4 rounded-full border border-current flex items-center justify-center";
                icon.innerHTML = '';
                text.innerText = "確認：我已完成上述兩步驟";
            }
        }

        // 6. 寵物種類切換邏輯
        function selectSpecies(species, labelEl) {
            // UI 更新
            document.querySelectorAll('.option-card input[name="petSpecies"]').forEach(el => {
                el.parentElement.classList.remove('selected', 'bg-white', 'border-brand-primary', 'shadow-md');
            });
            labelEl.classList.add('selected', 'bg-white', 'border-brand-primary', 'shadow-md');
            labelEl.querySelector('input').checked = true;

            // SPA 列表切換
            if (species === '犬') {
                document.getElementById('dog-spa-list').classList.remove('hidden');
                document.getElementById('cat-spa-list').classList.add('hidden');
            } else {
                document.getElementById('dog-spa-list').classList.add('hidden');
                document.getElementById('cat-spa-list').classList.remove('hidden');
            }
        }

        // 7. 高風險檢查
        function checkRisk(age) {
            const warning = document.getElementById('risk-warning');
            const ageNum = parseInt(age);
            if (ageNum >= 8 || ageNum <= 1) {
                warning.classList.remove('hidden');
            } else {
                warning.classList.add('hidden');
            }
        }

        // 8. 帶入歷史資料 Demo
        function autoFillDemo() {
            const phone = document.getElementById('phone').value;
            if (phone === '0912345678') {
                alert('已找到歷史紀錄！自動帶入測試資料...');
                document.getElementById('ownerName').value = '測試飼主';
                document.getElementById('email').value = 'test@example.com';
                document.getElementById('ownerId').value = 'A123456789';
                document.getElementById('address').value = '台北市松山區測試路段';
                document.getElementById('emergencyName').value = '王小明';
                document.getElementById('emergencyPhone').value = '0987654321';
                document.getElementById('petName').value = '旺財';
                document.getElementById('breed').value = '柴犬';
                document.getElementById('ageYear').value = '5';
                document.getElementById('weight').value = '12';
                checkRisk(5);
            } else {
                alert('查無此號碼 (測試號碼: 0912345678)');
            }
        }
// 新增：通用單選按鈕樣式切換
        function updateRadioStyle(label) {
            // 找到同組的所有 radio label
            const radioName = label.querySelector('input').name;
            document.querySelectorAll(`input[name="${radioName}"]`).forEach(input => {
                const parent = input.closest('.option-card');
                if (parent) parent.classList.remove('selected', 'bg-white', 'border-brand-primary', 'shadow-md');
            });
            // 點亮自己
            label.classList.add('selected', 'bg-white', 'border-brand-primary', 'shadow-md');
            label.querySelector('input').checked = true;
        }

        // 新增：切換輸入框顯示 (用於病史與晶片)
        function toggleInput(elementId, show) {
            const el = document.getElementById(elementId);
            if (show) {
                el.classList.remove('hidden');
                el.required = true;
                setTimeout(() => el.focus(), 100);
            } else {
                el.classList.add('hidden');
                el.required = false;
                el.value = '';
            }
        }
// 新增：切換打結選項顯示
        function toggleMatting(label) {
            const checkbox = label.querySelector('input[type="checkbox"]');
            const details = document.getElementById('matting-details');
            const arrow = document.getElementById('matting-arrow');

            // 使用 setTimeout 確保取得到點擊後的 checked 狀態
            setTimeout(() => {
                if (checkbox.checked) {
                    details.classList.remove('hidden');
                    arrow.style.transform = 'rotate(180deg)';
                    label.classList.add('selected', 'bg-white', 'border-brand-primary', 'shadow-md');
                } else {
                    details.classList.add('hidden');
                    arrow.style.transform = 'rotate(0deg)';
                    label.classList.remove('selected', 'bg-white', 'border-brand-primary', 'shadow-md');
                    
                    // 取消勾選時，清空裡面的選擇，避免誤判
                    document.querySelectorAll('input[name="mattingChoice"]').forEach(r => r.checked = false);
                }
            }, 0);
        }
// 新增：計算總金額功能
        function calculateTotal() {
            // 1. 取得基礎報價 (如果沒填則為 0)
            let base = parseInt(document.getElementById('basePrice').value) || 0;

            // 2. 計算升級項目
            let upgradeMin = 0;
            let upgradeMax = 0;
            let hasVariable = false; // 是否有包含浮動價格的項目

            document.querySelectorAll('input[name="spaUpgrades"]:checked').forEach(cb => {
                // 處理價格字串：移除 '+' 和 '元' (例如: "+199" -> "199", "+399~599" -> "399~599")
                let priceStr = cb.dataset.price.replace('+', '').replace(/元/g, '').trim();
                
                if (priceStr.includes('~')) {
                    // 處理範圍價格 (例如 399~599)
                    let parts = priceStr.split('~');
                    let min = parseInt(parts[0]);
                    let max = parseInt(parts[1]);
                    upgradeMin += min;
                    upgradeMax += max;
                    hasVariable = true;
                } else {
                    // 處理固定價格
                    let val = parseInt(priceStr);
                    upgradeMin += val;
                    upgradeMax += val;
                }
            });

            // 3. 更新介面顯示
            
            // 升級小計顯示
            let upgradeText = hasVariable ? `+$${upgradeMin} ~ $${upgradeMax}` : `+$${upgradeMin}`;
            document.getElementById('upgradeTotalDisplay').innerText = upgradeText;

            // 總金額顯示
            let totalMin = base + upgradeMin;
            let totalMax = base + upgradeMax;
            
            // 如果基礎價格是 0 且沒有選購升級，顯示 $0
            if (totalMin === 0 && totalMax === 0) {
                document.getElementById('totalPriceDisplay').innerText = "$0";
                return;
            }

            let totalText = hasVariable ? `$${totalMin} ~ $${totalMax}` : `$${totalMin}`;
            document.getElementById('totalPriceDisplay').innerText = totalText;
        }
        // 9. 表單提交
        function handleFormSubmit(e) {
            e.preventDefault();
            // 這裡加入各種檢查
            if (!lineConfirmed) {
                alert('請先確認已加入 LINE 官方帳號並傳送貼圖！');
                document.getElementById('view-grooming').scrollIntoView();
                return;
            }
            
// 檢查打結方案 (只有在勾選「疑似有打結」時才檢查)
            const mattingCheckbox = document.querySelector('input[name="mattingSuspected"]');
            if (mattingCheckbox && mattingCheckbox.checked) {
                const mattingChoice = document.querySelector('input[name="mattingChoice"]:checked');
                if (!mattingChoice) {
                    alert('您勾選了「疑似有打結」，請在下方卷軸中選擇一種處理方案（方案一或方案二）。');
                    return;
                }
            }

// 高風險檢查
            const riskCheckbox = document.getElementById('risk-checkbox');
            if (!document.getElementById('risk-warning').classList.contains('hidden') && !riskCheckbox.checked) {
                alert('請勾選同意高風險服務責任');
                return;
            }

            // 新增：檢查簽名
            if(document.getElementById('signatureData').value === '') {
                alert('請進行數位簽名！');
                return;
            }

            alert('預約送出成功！(這是靜態頁面 Demo)');
            switchView('home');
        }
// --- 數位簽名功能 ---
        let canvas, ctx, isDrawing = false;

        function openSignaturePad() {
            const modal = document.getElementById('signature-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden'; // 禁止背景捲動
            
            // 初始化 Canvas
            setTimeout(initCanvas, 100); // 延遲一下確保 modal 展開後抓得到尺寸
        }

        function closeSignaturePad() {
            const modal = document.getElementById('signature-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = '';
        }

        function initCanvas() {
            canvas = document.getElementById('sig-canvas');
            const container = document.getElementById('canvas-container');
            ctx = canvas.getContext('2d');

            // 設定畫布尺寸為實際顯示尺寸
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;

            // 筆觸設定
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#594A42'; // brand-text color

            // 綁定事件
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // 觸控事件
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                startDrawing({ clientX: touch.clientX, clientY: touch.clientY });
            }, { passive: false });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                draw({ clientX: touch.clientX, clientY: touch.clientY });
            }, { passive: false });

            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function saveSignature() {
            // 簡單檢查是否有內容 (判斷像素) - 這裡簡化直接存
            const dataUrl = canvas.toDataURL('image/png');
            
            // 更新 UI
            document.getElementById('signature-trigger').classList.add('hidden');
            document.getElementById('signature-result').classList.remove('hidden');
            document.getElementById('sig-image').src = dataUrl;
            document.getElementById('signatureData').value = dataUrl; // 存入隱藏欄位供表單送出
            
            // 設定時間
            const now = new Date();
            const timeStr = now.getFullYear() + '/' + 
                           (now.getMonth()+1).toString().padStart(2, '0') + '/' + 
                           now.getDate().toString().padStart(2, '0') + ' ' + 
                           now.getHours().toString().padStart(2, '0') + ':' + 
                           now.getMinutes().toString().padStart(2, '0') + ':' + 
                           now.getSeconds().toString().padStart(2, '0');
            document.getElementById('sig-timestamp').innerText = timeStr;

            closeSignaturePad();
            
            // 重新初始化圖示 (因為 trash icon 是新顯示的)
            lucide.createIcons();
        }

        function resetSignature() {
            if(confirm('確定要清除簽名並重新簽署嗎？')) {
                document.getElementById('signature-trigger').classList.remove('hidden');
                document.getElementById('signature-result').classList.add('hidden');
                document.getElementById('signatureData').value = '';
            }
        }
        // 啟動
        window.addEventListener('load', init);

    </script>
    <div id="signature-modal" class="fixed inset-0 z-50 bg-white hidden flex-col">
        <div class="bg-brand-bg px-4 py-3 flex justify-between items-center shadow-sm shrink-0">
            <h3 class="font-bold text-brand-text">請在下方簽名</h3>
            <button type="button" onclick="closeSignaturePad()" class="p-2 text-brand-light hover:text-brand-dark">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>

        <div class="flex-1 relative bg-gray-50 touch-none overflow-hidden" id="canvas-container">
            <canvas id="sig-canvas" class="absolute top-0 left-0 w-full h-full cursor-crosshair"></canvas>
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-20 text-4xl font-bold text-gray-300 select-none">
                在此區域書寫
            </div>
        </div>

        <div class="p-4 bg-white border-t border-brand-primary/10 flex gap-3 shrink-0 pb-8">
            <button type="button" onclick="clearCanvas()" class="flex-1 py-3 rounded-xl border border-brand-primary text-brand-primary font-bold">清除重寫</button>
            <button type="button" onclick="saveSignature()" class="flex-1 py-3 rounded-xl bg-brand-text text-white font-bold shadow-lg">確認簽名</button>
        </div>
    </div>
</body>
</html>
